---
title: "Mesto_a_venkov"
author: "Lucia Kvasnickova"
date: "3/23/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libs, echo = FALSE}
library(tidyverse)
library(readxl)
```

## R Markdown
}
This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r import echo=FALSE}
Mesto_a_venkov <- read_excel("../data/Mesto_a_venkov.xlsx", 
    col_types = c("date", "skip", "text", 
        "text", "text", "text", "text", "text", 
        "text", "skip", "skip", "text", "text", 
        "text", "text", "text", "text", "text", 
        "text", "text", "text", "text", "numeric", 
        "text", "numeric", "text", "text", 
        "text", "text", "skip", "text", "text", 
        "skip", "skip", "text", "text", "text", 
        "text", "text", "text", "text", "text", 
        "text", "text", "text", "text", "text"))
Mesto_a_venkov
```

## "Okolí města přiřadíme k venkovu
Máme tam pouze čtyři případy.

```{r bydliste, echo=FALSE}
Mesto_a_venkov$Bydliste <- as.factor(Mesto_a_venkov$Bydliste)
levels(Mesto_a_venkov$Bydliste) <- c("Město", "Venkov", "Venkov")
```

```{r}
ggplot(data = Mesto_a_venkov, mapping = aes(x=Pohlavi))+
  geom_bar()
```

```{r}
ggplot(data = Mesto_a_venkov, mapping = aes(x=Vek))+
  geom_bar()
```

```{r}
Mesto_a_venkov %>% 
  select(Bydliste, Spokojenost...8) %>%
  group_by(Bydliste) %>%
  summarise(
    Celkem = n(),
    Nespokojen = sum(Spokojenost...8 == "Ne"),
    Nespokojenost_perc = Nespokojen/Celkem*100,
    Chyba_perc = sqrt(Nespokojenost_perc/100 * (1-Nespokojenost_perc/100)/n())*100
    ) -> Nespokojenost
Nespokojenost
ggplot(data = Nespokojenost, mapping = aes(x = Bydliste, y = Nespokojenost_perc)) + 
  geom_bar(stat = "identity", width = 0.5, fill = "red", alpha = 0.4) + 
  geom_point(size = 3) +
  geom_errorbar(mapping = aes(ymin=Nespokojenost_perc - Chyba_perc, ymax=Nespokojenost_perc + Chyba_perc), width = 0.2, size = 0.5) +
  ggtitle("Nespokojenost s bydlením podle současného bydlení") + 
  xlab("Současné bydlení") + 
  ylab("Nespokojenost, %")
```

## Otázky
Všechno podle bydliště
- Proč bydlíte, kde bydlíte - důvody podle bydliště
- Jak dlouho dojíždíte do práce/školy
- Kde chcete trávit lockdown v závislosti od bydliště
- Změnil lockdow vás pohled na bydlení
- Kde trávíte volný čas v závislosti na bydlišti
- Prečo bývate tam kde bývate podľa spokojnosti
- Dojazd k lekárovi
- Čo je dostupné v závislosti od toho, kde bydlíte

## Proč bydlíte, kde bydlíte
Hlavní důvod pro bydlení v současném bydlišti

```{r}
Mesto_a_venkov %>% 
  select(
    Datum_a_cas,
    Bydliste,
    Spokojenost...7,
    Proc_bydlite_zde
  ) %>%
  mutate(
    present = 1
  ) %>%
  pivot_wider(
    names_from = Proc_bydlite_zde,
    values_from = present,
    values_fill = 0
  ) %>%
  group_by(Bydliste) %>%
  summarise(
    Dostupnost = sum(`Dobrá dostupnost`),
    Rodina = sum(Rodina),
    Bydleni = sum(`Dům`),
    Prostredi = sum(`Prostředí`),
    Neuvedeno = sum(Neuvedeno),
    Celkem = n()
  ) -> duvody_bydleni
duvody_bydleni
Mesto_a_venkov %>%
  ggplot(mapping = aes(x = Proc_bydlite_zde, fill = Spokojenost...7 )) +
  facet_grid(Bydliste~.) +
  geom_bar() + 
  ggtitle("Důvody pro současné bydlení") + 
  xlab("Proč bydlím zde") + 
  ylab("Počet odpovědí") + 
  labs(fill="Spokojenost")

```
## Co je dostupné v závislosti od toho, kde bydlíte

```{r}
Mesto_a_venkov %>%
  select(
    Datum_a_cas,
    Bydliste,
    Spokojenost...7,
    Vzdelavaci_instituce,
    Zdravotni_pece,
    Kultura,
    Moznost_vyberu,
    Priroda,
    Dostupnost_blizkych,
    Prace,
    Dojizdka,
    Sluzby,
    Restaurace
  ) %>%
  mutate(
    Donaska = Dojizdka
  ) %>%
  group_by(
    Bydliste,
    Spokojenost...7
  ) %>%
  summarise_at(
    .vars = c("Vzdelavaci_instituce", "Zdravotni_pece", "Kultura", "Moznost_vyberu",
              "Priroda", "Dostupnost_blizkych", "Prace", "Donaska", "Sluzby", "Restaurace"),
    .funs = ~sum(.x=="Ano")/n()*100
  ) %>% 
  pivot_longer(
    cols = c("Vzdelavaci_instituce", "Zdravotni_pece", "Kultura", "Moznost_vyberu",
              "Priroda", "Dostupnost_blizkych", "Prace", "Donaska", "Sluzby", "Restaurace"),
    names_to = "Kategorie",
    values_to = "Dostupnost"
  ) %>%
  ggplot(mapping = aes(x = Kategorie, y = Dostupnost, fill = Spokojenost...7)) + 
  facet_grid(Bydliste~.)+
  geom_bar(stat = "identity") +
  theme(
    #legend.position = "none",
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)
    ) +
  ggtitle("Důležité faktory pro výběr bydlení v závislosti od současného bydliště") + 
  xlab("Faktor") + 
  ylab("Zastoupení, %")
```

```{r}

  )


```

## Co je pro vás stěžejní pro výběr bydliště

## Jak dlouho dojíždíte do práce/školy

```{r}
Mesto_a_venkov %>%
  select(
    Datum_a_cas,
    Bydliste,
    Volny_cas,
    Dojezd_prace_jidlo_verbose
  ) %>%
  mutate(
    present = 1
  ) %>%
  pivot_wider(
    names_from = Dojezd_prace_jidlo_verbose,
    values_from = present,
    values_fill = 0
  ) %>%
  group_by(Bydliste) %>%
  summarise(
    `Do 20 minut` = sum(`Do 20 minut`)/n()*100,
    `30-45 minut` = sum(`30 - 45 minut`)/n()*100,
    Hodina = (sum(Hodina) + sum(`Více jak hodina`))/n()*100
  ) -> dojezd_do_prace
dojezd_do_prace
Mesto_a_venkov %>%
  mutate(
    Dojezd_prace_jidlo_verbose = ifelse(Dojezd_prace_jidlo_verbose=="Více jak hodina", "Hodina", Dojezd_prace_jidlo_verbose),
    Dojezd_prace_jidlo_verbose = as.factor(Dojezd_prace_jidlo_verbose),
    Dojezd_prace_jidlo_verbose = relevel(Dojezd_prace_jidlo_verbose, "Do 20 minut")
  ) %>%
  ggplot(mapping = aes(x=Dojezd_prace_jidlo_verbose, fill = Dojizdite_do_prace)) +
  facet_grid(Bydliste~.) +
  geom_bar()+
  ggtitle("Únosná doba dojezdu do práce nebo za jídlem") + 
  xlab("Únosná doba dojezdu") + 
  ylab("Počet odpovědí") + 
  labs(fill="Dojíždím 45 min a víc")
```

## 

```{r}
library(ggalluvial)
Mesto_a_venkov %>% 
  arrange(Bydliste, Lockdown_mesto_venkov) %>%
ggplot(mapping = aes(axis1 = Bydliste, axis2 = Lockdown_mesto_venkov)) +
  geom_alluvium(aes(fill = Bydliste), width = 1/6) +
  geom_stratum(width = 1/12, fill = "grey", color = "black", alpha=0.5) +
  geom_label(stat = "stratum", aes(label = after_stat(stratum))) + 
  scale_x_discrete(limits = c("Bydlím", "Chtěl bych bydlet"), expand = c(.05, .05)) +
  scale_fill_brewer(type = "qual", palette = "Set1") +
  theme_minimal()
```
      
 